"use strict";function sendRSVPtoServer(e){try{$.ajax({url:"/RSVP/SubmitRSVP",type:"GET",success:function(t){e(0)},error:function(t){401==t.status?window.location.href="/Identity/Account/Login?ReturnUrl=%2FRSVP%2FSubmitRSVPs":(e(1),sendErrorReportToServer("sendRSVPtoServer()",t.responseText))}})}catch(t){e(1),sendErrorReportToServer("sendRSVPtoServer()",t)}}function setLocalStorage(e){if(!e)return 1;try{var t=window.localStorage,r={_rsvp:e.rsvp,_FN:e.firstName,_hasPN:e.phoneNumber};return t.setItem("InspIntData",JSON.stringify(r)),0}catch(e){return sendErrorReportToServer("setLocalStorage()",e),1}}function setSession(e){if(!e)return 1;try{var t={_rsvp:e.rsvp,_FN:e.firstName,_hasPN:e.phoneNumber};return sessionStorage.setItem("InspIntData",JSON.stringify(t)),0}catch(e){sendErrorReportToServer("setSession()",e)}}function requestViewModelFromServer(e){try{$.ajax({url:"/Home/GetViewModel",type:"GET",success:function(t){e(t)},error:function(e){sendErrorReportToServer("requestViewModelFromServer()",e.responseText)}})}catch(e){sendErrorReportToServer("requestViewModelFromServer()",e)}}function getViewModel(){try{return 0!==localStorage.length?JSON.parse(localStorage.getItem("InspIntData")):0!==sessionStorage.length?JSON.parse(sessionStorage.getItem("InspIntData")):(sendErrorReportToServer("getViewModel()","Returning null value as view model!"),null)}catch(e){return sendErrorReportToServer("getViewModel()",e+" Returning null value as view model!"),null}}function appendDateOfNextClass(e){if(!e||"Invalid Date"===new Date(e).toString())return 1;var t=document.getElementsByClassName("showNextClass"),r=document.createElement("span"),n=e.split("T")[0],o=(new Date).toISOString().split("T")[0],s=new Date(n+"T00:00:00Z").toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"});return s===new Date(o+"T00:00:00Z").toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})?(r.innerText=" today at 1:00pm.",t[0].appendChild(r.cloneNode(!0)),t[1].appendChild(r),0):(r.innerText=" on "+s+".",t[0].appendChild(r.cloneNode(!0)),t[1].appendChild(r),0)}function appendUsersFirstName(e){if(null===e)return 1;try{var t=document.getElementsByClassName("salute");t[0].innerText="Hello "+e+",",t[1].innerText="Hello "+e+","}catch(e){return console.error(e),1}}function display(e){if(!e)return console.error("Supply a valid viewModel as parameter."),1;var t=document.getElementById("will-you-rsvp"),r=document.getElementById("get-phoneNumber"),n=document.getElementById("rsvp-done"),o=document.getElementById("preloader");try{if(!0===e._rsvp){if("false"===e._hasPN)return t.style.display="none",n.style.display="none",o.style.display="none",r.style.display="block",0;if(r.style.display="none",t.style.display="none",o.style.display="none",n.style.display="block","declined"===e._hasPN){var s=document.createElement("button");s.classList.add("submitPhoneNumber"),s.innerText="Submit PhoneNumber",s.addEventListener("click",(function(){n.style.display="none",r.style.display="block",n.removeChild(s)})),n.appendChild(s)}return 0}return n.style.display="none",r.style.display="none",o.style.display="none",t.style.display="block",1}catch(e){return 1}}function sendErrorReportToServer(e,t){if(e&&t)try{var r=JSON.stringify({Sender:e,ErrorMessage:t});$.ajax({url:"/Home/sendErrorReports",type:"POST",contentType:"application/json, charset utf8",dataType:"text",data:r,success:function(e){console.log(e)},error:function(e){console.log("Error from sendErrorReportToServer: "+e)}})}catch(e){return void console.error("Error from sendErrorReportToServer")}else console.error("Please pass a valid parameter to the sendErrorReportToServer function.")}function sendUserPhoneNumberToServer(e,t){if(/^[0-9]{11,15}$/.test(e))try{var r={phoneNumber:e};$.ajax({url:"/RSVP/saveUserPhoneNumber",type:"POST",contentType:"application/json, charset utf8",dataType:"text",data:JSON.stringify(r),success:function(e){t(0)},error:function(e){if(401!=e.status)return sendErrorReportToServer("sendUserPhoneNumberToServer()",e.responseText),void t(1);window.location.href="/Identity/Account/Login?ReturnUrl=%2FHome"}})}catch(e){t(1),console.error("Error from submitButton"+e)}else $("#phoneNumber-input").val("")}$("div.nav_handle-container").click((function(){$(".toggled").is(":visible")?$(".toggled").hide(500):$(".toggled").show(500)})),$(".rsvp-cover").ready((function(){var e=getViewModel();null===e&&requestViewModelFromServer((function(e){0!==setLocalStorage(e)&&setSession(e),window.location.reload()})),appendUsersFirstName(e._FN),appendDateOfNextClass(sessionStorage.getItem("_dateOfNextClass")),display(e)})),$("#sign-out-btn").click((function(){var e=getViewModel();e._rsvp=!1,e._FN=null,e._hasPN=null;try{localStorage.setItem("InspIntData",JSON.stringify(e))}catch(t){sessionStorage.setItem("InspIntData",JSON.stringify(e))}})),$("#rsvp-ok").click((function(){var e=document.getElementById("will-you-rsvp"),t=document.getElementById("preloader");e.style.display="none",t.style.display="block",setTimeout((function(){sendRSVPtoServer((function(r){if(0!==r)return alert("Something went wrong while submiting your rsvp. Please try again later."),e.style.display="block",void(t.style.display="none");var n=getViewModel();n._rsvp=!0;try{localStorage.setItem("InspIntData",JSON.stringify(n))}catch(e){sessionStorage.setItem("InspIntData",JSON.stringify(n))}display(n)}))}),1e3)})),$("#decline-submit").click((function(e){e.preventDefault(),$("#phoneNumber-input").val(""),$("#phoneNumber-input-error").css("display","none");var t=getViewModel();t._hasPN="declined";try{var r=window.localStorage;r.setItem("InspIntData",JSON.stringify(t))}catch(e){r.setItem("InspIntData",JSON.stringify(t))}display(t)})),$("#phoneNumber-form").submit((function(e){e.preventDefault();var t=$("#phoneNumber-input").val();if(/^[0-9]{11,15}$/.test(t)){var r=document.getElementById("get-phoneNumber"),n=document.getElementById("preloader");r.style.display="none",n.style.display="block",setTimeout((function(){sendUserPhoneNumberToServer(t,(function(e){if(0!==e)return alert("Something went wrong while submiting your phone number. Please try again later."),willYouRSVP.style.display="block",void(n.style.display="none");var t=getViewModel();t._hasPN="true";try{localStorage.setItem("InspIntData",JSON.stringify(t))}catch(e){sessionStorage.setItem("InspIntData",JSON.stringify(t))}display(t)}))}),1e3)}else $("#phoneNumber-input").val("")}));